  # Django Backend
services:
    # Django Backend (Docker runtime)
    - type: web
      name: shieldher-backend
      runtime: docker
      plan: free
      autoDeploy: true
      dockerfilePath: ./backend/Dockerfile
      dockerContext: ./backend
      healthCheckPath: /api/health/
      envVars:
        - key: DJANGO_SETTINGS_MODULE
          value: config.settings.production
        - key: DJANGO_SECRET_KEY
          generateValue: true
        - key: JWT_SECRET_KEY
          generateValue: true
        - key: ENCRYPTION_KEY
          sync: false
        - key: DATABASE_URL
          sync: false
        - key: DJANGO_ALLOWED_HOSTS
          value: .onrender.com
        - key: DEBUG
          value: "False"
        - key: CORS_ALLOWED_ORIGINS
          sync: false
        - key: PORT
          value: "8000"

    # React Frontend (Static site)
    - type: web
      name: shieldher-frontend
      runtime: static
      plan: free
      autoDeploy: true
      buildCommand: npm ci && npm run build
      staticPublishPath: dist
      rootDir: frontend
      envVars:
        - key: VITE_API_URL
          sync: false
      routes:
        - type: rewrite
          source: /*
          destination: /index.html
